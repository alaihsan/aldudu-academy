<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ course.name }} - Aldudu Academy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div id="app-page">
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <a href="{{ url_for('main.dashboard') }}" class="header-logo">Aldudu Academy</a>
                </div>
                <div class="header-right">
                    <a href="{{ url_for('main.dashboard') }}" class="btn-link">Kembali ke Dasbor</a>
                </div>
            </div>
        </header>

        <main class="container" data-course-id="{{ course.id }}">
            <h1 class="content-title">{{ course.name }}</h1>
            
            <div class="course-details-container">
                <p><strong>Wali Kelas:</strong> {{ course.teacher.name }}</p>
                <p><strong>Tahun Ajaran:</strong> {{ course.academic_year.year }}</p>

                <hr style="margin: 2rem 0;">

                <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem;">Materi & Tugas</h2>
                
                {% if is_teacher %}
                <div style="margin-bottom: 1.5rem;">
                    <div class="dropdown">
                        <button id="add-topics-button" class="btn btn-primary dropdown-toggle">
                            + Add Topics
                        </button>
                        <div id="topics-dropdown-menu" class="dropdown-menu hidden">
                            <a href="#" class="dropdown-item">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-item-icon">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <span>Add Assignment</span>
                            </a>
                            <a href="#" class="dropdown-item">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-item-icon">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                                </svg>
                                <span>Add Folder</span>
                            </a>
                            <a href="#" id="show-create-quiz-modal" class="dropdown-item">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="dropdown-item-icon quiz-icon">
                                  <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="currentColor"/>
                                </svg>
                                <span>Add Quiz</span>
                            </a>
                            <a href="#" id="show-create-link-modal" class="dropdown-item">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-item-icon">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.004-.004L18.375 12.74a3 3 0 11-4.242-4.242L6.28 16.162a4.5 4.5 0 006.364 6.364l7.693-7.693z" />
                                </svg>
                                <span>Add Link</span>
                            </a>
                            <a href="#" id="show-create-file-modal" class="dropdown-item">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-item-icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625a3.375 3.375 0 00-3.375 3.375v11.25a3.375 3.375 0 003.375 3.375h12.75a3.375 3.375 0 003.375-3.375V11.25a9 9 0 00-9-9z" />
                                </svg>
                                <span>Add File</span>
                            </a>
                            <a href="#" class="dropdown-item">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-item-icon">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193l-3.722.06c-.247.007-.48.057-.7.144a4.5 4.5 0 01-2.586 0c-.22-.087-.453-.137-.7-.144l-3.722-.06c-1.133-.093-1.98-1.057-1.98-2.193V10.608c0-.97.616-1.813 1.5-2.097m14.25-6.118c-.228.06-.447.11-.66.162a4.5 4.5 0 00-2.586 0c-.213-.051-.432-.102-.66-.162m14.25 6.118A4.491 4.491 0 0018 10.5c-1.052 0-2.062.18-3 .512a4.5 4.5 0 00-2.586 0c-.938-.333-1.948-.512-3-.512-1.052 0-2.062.18-3 .512a4.5 4.5 0 00-2.586 0c-.938-.333-1.948-.512-3-.512A4.491 4.491 0 001.5 10.5c0 .97.616 1.813 1.5 2.097m14.25-6.118c-.228.06-.447.11-.66.162a4.5 4.5 0 00-2.586 0c-.213-.051-.432-.102-.66-.162" />
                                </svg>
                                <span>Add Discussion</span>
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <div class="view-controls">
                    <div class="view-switcher">
                        <button id="grid-view-btn" class="view-btn active" title="Grid View">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 8.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25v2.25A2.25 2.25 0 018.25 21H6a2.25 2.25 0 01-2.25-2.25v-2.25zM13.5 6A2.25 2.25 0 0115.75 3.75h2.25A2.25 2.25 0 0120.25 6v2.25a2.25 2.25 0 01-2.25 2.25h-2.25A2.25 2.25 0 0113.5 8.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25h2.25a2.25 2.25 0 012.25 2.25v2.25a2.25 2.25 0 01-2.25 2.25h-2.25a2.25 2.25 0 01-2.25-2.25v-2.25z" /></svg>
                        </button>
                        <button id="row-view-btn" class="view-btn" title="List View">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5" /></svg>
                        </button>
                    </div>
                </div>

                <div id="topics-container" class="topics-grid-view">
                    {% if topics %}
                        {% for topic in topics %}
                            <div class="topic-card">
                                {% if topic.type == 'Link' or topic.type == 'Berkas' %}
                                <a href="{{ topic.url }}" target="_blank" class="topic-link">
                                {% else %}
                                <a href="{{ topic.url }}" class="topic-link">
                                {% endif %}
                                    <div class="topic-icon">
                                        {% if topic.type == 'Link' %}
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-item-icon">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.004-.004L18.375 12.74a3 3 0 11-4.242-4.242L6.28 16.162a4.5 4.5 0 006.364 6.364l7.693-7.693z" />
                                        </svg>
                                        {% elif topic.type == 'Berkas' %}
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="dropdown-item-icon">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625a3.375 3.375 0 00-3.375 3.375v11.25a3.375 3.375 0 003.375 3.375h12.75a3.375 3.375 0 003.375-3.375V11.25a9 9 0 00-9-9z" />
                                        </svg>
                                        {% else %}
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="dropdown-item-icon quiz-icon">
                                          <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="currentColor"/>
                                        </svg>
                                        {% endif %}
                                    </div>
                                    <div class="topic-info">
                                        <div class="topic-name">{{ topic.name }}</div>
                                        <div class="topic-details">
                                            <span>{{ topic.type }}</span>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="no-content-message">Belum ada materi atau tugas di kelas ini.</p>
                    {% endif %}
                </div>



                <h2 style="font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem;">Daftar Murid</h2>
                <div class="content-placeholder">
                    <p>Fitur untuk menambah dan melihat daftar murid akan dibuat di sini.</p>
                </div>
            </div>
        </main>
    </div>

    <div id="create-quiz-modal" class="modal hidden">
    <div class="modal-content">
        <form id="create-quiz-form">
            <div class="modal-header">
                <h3>Buat Kuis Baru</h3>
                <p>Masukkan detail untuk kuis baru di kelas ini.</p>
            </div>

            <div class="modal-body">

                <div class="form-group">
                    <label for="quiz-name-input" class="form-label">Nama Kuis</label>
                    <input type="text" id="quiz-name-input" class="form-input" required placeholder="Contoh: Ujian Harian 1 - Bab Fotosintesis">
                </div>

                <div class="form-row-flex">
                    <div class="form-group" style="flex: 2;">
                        <label for="quiz-due-start" class="form-label">Mulai (Opsional)</label>
                        <input type="datetime-local" id="quiz-due-start" class="form-input">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label for="quiz-due-finish" class="form-label">Selesai (Opsional)</label>
                        <input type="datetime-local" id="quiz-due-finish" class="form-input">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="quiz-points" class="form-label">Point</label>
                        <input type="number" id="quiz-points" class="form-input" value="100" min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label for="quiz-category" class="form-label">Category</label>

                    <div id="category-select-wrapper">
                        <select id="quiz-category" class="form-input">
                            <option value="">(blank)</option>
                            <option value="ungraded">Ungraded</option>
                            <option value="_create_new_">Create new grading category</option>
                        </select>
                    </div>

                    <div id="category-input-wrapper" class="hidden" style="position: relative; display: flex; align-items: center;">
                        <input type="text" id="quiz-category-new" class="form-input" placeholder="Nama Kategori Baru...">
                        <button type="button" id="category-cancel-button" class="btn-cancel-inline">&times;</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="quiz-grade-type" class="form-label">Tipe Nilai</label>
                    <select id="quiz-grade-type" class="form-input">
                        <option value="numeric">Numeric</option>
                        <option value="letter">A, B, C, D</option>
                    </select>
                </div>

                <div id="quiz-modal-error" class="form-error hidden"></div>
            </div>

            <div class="modal-footer">
                <button type="button" id="quiz-cancel-button" class="btn btn-secondary">Batal</button>
                <button type="submit" class="btn btn-primary">Simpan Kuis</button>
            </div>
        </form>
    </div>
    </div>

    <div id="create-link-modal" class="modal hidden">
    <div class="modal-content">
        <form id="create-link-form">
            <div class="modal-header">
                <h3>Tambah Link Baru</h3>
                <p>Masukkan detail untuk link baru di kelas ini.</p>
            </div>

            <div class="modal-body">

                <div class="form-group">
                    <label for="link-name-input" class="form-label">Nama Link</label>
                    <input type="text" id="link-name-input" class="form-input" required placeholder="Contoh: Materi Pembelajaran Online">
                </div>

                <div class="form-group">
                    <label for="link-url-input" class="form-label">Link URL</label>
                    <input type="url" id="link-url-input" class="form-input" required placeholder="https://example.com">
                </div>

                <div id="link-modal-error" class="form-error hidden"></div>
            </div>

            <div class="modal-footer">
                <button type="button" id="link-cancel-button" class="btn btn-secondary">Batal</button>
                <button type="submit" class="btn btn-primary">Simpan Link</button>
            </div>
        </form>
    </div>
    </div>

    <div id="create-file-modal" class="modal hidden">
    <div class="modal-content">
        <form id="create-file-form" enctype="multipart/form-data">
            <div class="modal-header">
                <h3>Tambah File Baru</h3>
                <p>Masukkan detail untuk file baru di kelas ini.</p>
            </div>

            <div class="modal-body">

                <div class="form-group">
                    <label for="file-name-input" class="form-label">Nama File</label>
                    <input type="text" id="file-name-input" class="form-input" required placeholder="Contoh: Materi Presentasi Bab 1">
                </div>

                <div class="form-group">
                    <label for="file-description-input" class="form-label">Deskripsi</label>
                    <textarea id="file-description-input" class="form-input" rows="3" placeholder="Deskripsi singkat tentang isi file..."></textarea>
                </div>

                <div class="form-group">
                    <label for="file-upload-input" class="form-label">Upload File</label>
                    <input type="file" id="file-upload-input" class="form-input" required>
                </div>

                <div class="form-row-flex">
                    <div class="form-group" style="flex: 1;">
                        <label for="file-start-date-input" class="form-label">Masa Berlaku (Mulai)</label>
                        <input type="datetime-local" id="file-start-date-input" class="form-input">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label for="file-end-date-input" class="form-label">Masa Berlaku (Selesai)</label>
                        <input type="datetime-local" id="file-end-date-input" class="form-input">
                    </div>
                </div>

                <div id="file-modal-error" class="form-error hidden"></div>
            </div>

            <div class="modal-footer">
                <button type="button" id="file-cancel-button" class="btn btn-secondary">Batal</button>
                <button type="submit" class="btn btn-primary">Simpan File</button>
            </div>
        </form>
    </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- LOGIKA UNTUK DROPDOWN "ADD TOPICS" ---
        const addTopicsButton = document.getElementById('add-topics-button');
        const topicsDropdownMenu = document.getElementById('topics-dropdown-menu');

        if (addTopicsButton) {
            addTopicsButton.addEventListener('click', function(e) {
                e.stopPropagation(); // Mencegah window click listener di bawah
                
                // Toggle menu visibility
                topicsDropdownMenu.classList.toggle('hidden'); 
                
                // Toggle button's "pressed" state
                addTopicsButton.classList.toggle('btn-pressed'); 
            });
        }

        // Sembunyikan dropdown jika klik di luar
        window.addEventListener('click', function(e) {
            if (topicsDropdownMenu && !topicsDropdownMenu.classList.contains('hidden')) {
                if (!addTopicsButton.contains(e.target)) {
                    topicsDropdownMenu.classList.add('hidden'); // Sembunyikan menu
                    
                    // Kembalikan tombol ke normal
                    addTopicsButton.classList.remove('btn-pressed'); 
                }
            }
        });
        // --- AKHIR LOGIKA DROPDOWN ---
        
        // --- Elemen Modal Kuis ---
        const quizModal = document.getElementById('create-quiz-modal');
        const showQuizModalButton = document.getElementById('show-create-quiz-modal');
        const quizCancelButton = document.getElementById('quiz-cancel-button');
        const quizForm = document.getElementById('create-quiz-form');
        const quizNameInput = document.getElementById('quiz-name-input');
        const quizModalError = document.getElementById('quiz-modal-error');

        // --- Elemen Modal Link ---
        const linkModal = document.getElementById('create-link-modal');
        const showLinkModalButton = document.getElementById('show-create-link-modal');
        const linkCancelButton = document.getElementById('link-cancel-button');
        const linkForm = document.getElementById('create-link-form');
        const linkNameInput = document.getElementById('link-name-input');
        const linkUrlInput = document.getElementById('link-url-input');
        const linkModalError = document.getElementById('link-modal-error');

        // --- Elemen Modal File ---
        const fileModal = document.getElementById('create-file-modal');
        const showFileModalButton = document.getElementById('show-create-file-modal');
        const fileCancelButton = document.getElementById('file-cancel-button');
        const fileForm = document.getElementById('create-file-form');
        const fileNameInput = document.getElementById('file-name-input');
        const fileDescriptionInput = document.getElementById('file-description-input');
        const fileUploadInput = document.getElementById('file-upload-input');
        const fileStartDateInput = document.getElementById('file-start-date-input');
        const fileEndDateInput = document.getElementById('file-end-date-input');
        const fileModalError = document.getElementById('file-modal-error');

        const mainContainer = document.querySelector('main.container');
        const courseId = mainContainer.dataset.courseId;

        // --- Fungsi untuk tampil/sembunyi modal ---
        const showQuizModal = () => {
            quizModal.classList.remove('hidden');
            quizNameInput.value = ''; // Kosongkan input
            quizModalError.classList.add('hidden'); // Sembunyikan error
        };

        const hideQuizModal = () => {
            quizModal.classList.add('hidden');
        };

        const showLinkModal = () => {
            linkModal.classList.remove('hidden');
            linkNameInput.value = ''; // Kosongkan input
            linkUrlInput.value = ''; // Kosongkan input
            linkModalError.classList.add('hidden'); // Sembunyikan error
        };

        const hideLinkModal = () => {
            linkModal.classList.add('hidden');
        };

        const showFileModal = () => {
            fileModal.classList.remove('hidden');
            fileNameInput.value = '';
            fileDescriptionInput.value = '';
            fileUploadInput.value = '';
            fileStartDateInput.value = '';
            fileEndDateInput.value = '';
            fileModalError.classList.add('hidden');
        };

        const hideFileModal = () => {
            fileModal.classList.add('hidden');
        };

        // --- Event Listeners ---
        // Pastikan tombol ada (hanya guru yang melihat)
        if (showQuizModalButton) {
            // Listener ini sekarang terpasang pada <a> "Add Quiz"
            showQuizModalButton.addEventListener('click', function(e) {
                e.preventDefault(); // Mencegah <a> melakukan navigasi
                showQuizModal();

                if (topicsDropdownMenu) {
                    topicsDropdownMenu.classList.add('hidden'); // Sembunyikan menu
                }

                // Pastikan tombol kembali normal saat item diklik
                if (addTopicsButton) {
                    addTopicsButton.classList.remove('btn-pressed');
                }
            });
        }

        // Pastikan tombol link ada
        if (showLinkModalButton) {
            showLinkModalButton.addEventListener('click', function(e) {
                e.preventDefault(); // Mencegah <a> melakukan navigasi
                showLinkModal();

                if (topicsDropdownMenu) {
                    topicsDropdownMenu.classList.add('hidden'); // Sembunyikan menu
                }

                // Pastikan tombol kembali normal saat item diklik
                if (addTopicsButton) {
                    addTopicsButton.classList.remove('btn-pressed');
                }
            });
        }

        // Pastikan quizCancelButton ada sebelum menambahkan listener
        if(quizCancelButton) {
            quizCancelButton.addEventListener('click', hideQuizModal);
        }

        // Pastikan linkCancelButton ada sebelum menambahkan listener
        if(linkCancelButton) {
            linkCancelButton.addEventListener('click', hideLinkModal);
        }

        if (showFileModalButton) {
            showFileModalButton.addEventListener('click', function(e) {
                e.preventDefault();
                showFileModal();

                if (topicsDropdownMenu) {
                    topicsDropdownMenu.classList.add('hidden');
                }

                if (addTopicsButton) {
                    addTopicsButton.classList.remove('btn-pressed');
                }
            });
        }

        if(fileCancelButton) {
            fileCancelButton.addEventListener('click', hideFileModal);
        }

        // --- Event Listener untuk Submit Form ---
        // Pastikan quizForm ada sebelum menambahkan listener
        if(quizForm) {
            quizForm.addEventListener('submit', async function(e) {
                e.preventDefault(); // Mencegah form submit biasa
                const quizName = quizNameInput.value.trim();
                
                if (!quizName) {
                    quizModalError.textContent = 'Nama kuis tidak boleh kosong.';
                    quizModalError.classList.remove('hidden');
                    return;
                }

                try {
                    const response = await fetch(`/api/courses/${courseId}/quizzes`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ name: quizName })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Gagal menyimpan kuis.');
                    }

                    // Tambahkan kuis baru ke daftar di halaman
                    // --- Jika Sukses ---
                    hideModal();

                    // Alihkan (redirect) halaman ke detail kuis yang baru dibuat
                    window.location.href = `/quiz/${data.quiz.id}`;
                    
                } catch (error) {
                    quizModalError.textContent = error.message;
                    quizModalError.classList.remove('hidden');
                }
            });
        }

        // --- Event Listener untuk Submit Form Link ---
        // Pastikan linkForm ada sebelum menambahkan listener
        if(linkForm) {
            linkForm.addEventListener('submit', async function(e) {
                e.preventDefault(); // Mencegah form submit biasa
                const linkName = linkNameInput.value.trim();
                const linkUrl = linkUrlInput.value.trim();

                if (!linkName) {
                    linkModalError.textContent = 'Nama link tidak boleh kosong.';
                    linkModalError.classList.remove('hidden');
                    return;
                }

                if (!linkUrl) {
                    linkModalError.textContent = 'URL link tidak boleh kosong.';
                    linkModalError.classList.remove('hidden');
                    return;
                }

                try {
                    const response = await fetch(`/api/courses/${courseId}/links`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ name: linkName, url: linkUrl })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Gagal menyimpan link.');
                    }

                    // Sukses: Sembunyikan modal dan reload halaman untuk menampilkan link baru
                    hideLinkModal();
                    window.location.reload();

                } catch (error) {
                    linkModalError.textContent = error.message;
                    linkModalError.classList.remove('hidden');
                }
            });
        }

        if(fileForm) {
            fileForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const fileName = fileNameInput.value.trim();
                const fileDescription = fileDescriptionInput.value.trim();
                const file = fileUploadInput.files[0];
                const startDate = fileStartDateInput.value;
                const endDate = fileEndDateInput.value;

                if (!fileName || !file) {
                    fileModalError.textContent = 'Nama file dan file upload tidak boleh kosong.';
                    fileModalError.classList.remove('hidden');
                    return;
                }

                const formData = new FormData();
                formData.append('name', fileName);
                formData.append('description', fileDescription);
                formData.append('file', file);
                formData.append('start_date', startDate);
                formData.append('end_date', endDate);

                try {
                    const response = await fetch(`/api/courses/${courseId}/files`, {
                        method: 'POST',
                        body: formData
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Gagal menyimpan file.');
                    }

                    hideFileModal();
                    window.location.reload();

                } catch (error) {
                    fileModalError.textContent = error.message;
                    fileModalError.classList.remove('hidden');
                }
            });
        }

        // --- LOGIKA UNTUK VIEW SWITCHER ---
        const gridViewBtn = document.getElementById('grid-view-btn');
        const rowViewBtn = document.getElementById('row-view-btn');
        const topicsContainer = document.getElementById('topics-container');

        if (gridViewBtn && rowViewBtn && topicsContainer) {
            gridViewBtn.addEventListener('click', () => {
                if (!gridViewBtn.classList.contains('active')) {
                    gridViewBtn.classList.add('active');
                    rowViewBtn.classList.remove('active');
                    topicsContainer.classList.remove('topics-row-view');
                    topicsContainer.classList.add('topics-grid-view');
                }
            });

            rowViewBtn.addEventListener('click', () => {
                if (!rowViewBtn.classList.contains('active')) {
                    rowViewBtn.classList.add('active');
                    gridViewBtn.classList.remove('active');
                    topicsContainer.classList.remove('topics-grid-view');
                    topicsContainer.classList.add('topics-row-view');
                }
            });
        }
    });
    </script>

</body>
</html>